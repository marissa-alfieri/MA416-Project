---
title: "Life Expectancy Trends (2000-2015)"
author: "Marissa Alfieri, Jenny Zheng, Letitia Caspersen"
date: "2025-11-04"
output:
  pdf_document:
    latex_engine: xelatex
---

## Introduction

Life expectancy says a lot about how people live and the conditions they face around the world. In this project, we wanted to look at how life expectancy differs across continents and how it changes over time. We started by checking whether continents already had different average life expectancies in the year 2000. That way we could get a baseline snapshot of global inequality. Then, we tested whether those differences changed between 2000 and 2015 to see if countries have been getting closer together or if the gap has stayed the same.

The main goal is to understand whether the differences in life expectancy reflect ongoing global inequality or improvements that are happening unevenly across regions.

The data come from Kaggle’s Life Expectancy 2000–2015 dataset (<https://www.kaggle.com/datasets/vrec99/life-expectancy-2000-2015>), which combines information from the World Health Organization, World Bank, and the United Nations. It includes 119 countries across 15 years, with variables like GDP per capita, CO₂ emissions, health expenditure, and internet access.

```{r intro}
data = read.csv("Life_Expectancy.csv")
```

## Section 1 – Comparing Continents in 2000

We wanted to start by establishing a baseline for global inequality in life expectancy. To see whether people in some continents were living longer than others at the start of the 21st century.

Our hypotheses were:

$$
\ H_0: \text{The distributions of life expectancy are the same across all continents.} \\
\ H_a: \text{At least one continent differs.}
$$

**Checking The Assumptions**

We planned to test this using a one-way ANOVA, so we first checked whether the assumptions of normality and equal variances were met.

1\. Normality

Normality is important because ANOVA assumes that residuals within each group are normally distributed.

$$
\ H_0: \text{The life expectancy values within each continent are normally distributed.} \\
\ H_a: \text{The life expectancy values within at least one continent deviate from normality.}
$$

For normality, we visually inspected histograms of life expectancy for each continent.

```{r, fig.width=4.5, fig.height=2.5, echo=FALSE}
data_2000 = subset(data, Year == 2000)
x = data_2000$Life.Expectancy
continents = unique(data_2000$Continent)
		
for (c in continents){
subset_data=data_2000$Life.Expectancy[data_2000$Continent == c]
  
 			 hist(subset_data,
  			     main = paste("Life Expectancy in", c, "2000"),
       xlab = "Life Expectancy",
       ylab = "Frequency",
       col = "skyblue",
       breaks = 5)
}

```

Visual inspection of the histograms suggested that the distributions were varied, with some having approximately bell shaped curves, some with unique distributions, and some skewed. To confirm normality statistically, we used a Monte Carlo Anderson–Darling test.

This test measures how far the observed data deviates from what would be expected under a normal distribution with the same mean and standard deviation. Comparing our observed statistic to this simulated one let us estimate the p-value and decide whether the normality assumption held.

```{r mc.ad}
set.seed(123123)
nmc = 10000
n = length(x)
mc_ad = c()

# observed statistic
x_sorted = sort(x)
F_emp = (1:n) / (n+1)
F_null = pnorm(x_sorted, mean(x_sorted), sd(x_sorted)) 
AD_obs = sum(((abs(F_emp - F_null))^2) / (F_emp * (1 - F_emp)))

# simulated normality
for(k in 1:nmc){
  smc = sort(rnorm(n, 0, 1))
  F_emp_mc = (1:n)/(n+1)
  F_null_mc = pnorm(smc, 0, 1)
  mc_ad = c(mc_ad, sum((F_emp_mc - F_null_mc)^2 / (F_emp_mc * (1 - F_emp_mc))))
  }

alpha = 0.10
ad_crit = quantile(mc_ad, 1 - alpha)
emp_pval = mean(mc_ad >= AD_obs)

cat("Anderson–Darling Critical Value:", round(ad_crit, 4), "\n")
cat("Empirical P-Value:", round(emp_pval, 4), "\n")
```

The Anderson–Darling test gave an empirical p-value of 0.0004, which is below the alpha level of 0.10. This means we reject the null hypothesis of normality. So, the life expectancy data for 2000 aren’t normally distributed. This makes sense because some continents have much higher averages while others are lower, so the data are naturally skewed instead of bell-shaped.

Since ANOVA assumes that each group’s residuals are roughly normal, this result means we can’t fully rely on that assumption. Before deciding how to move forward, we also wanted to check whether the variability between groups was similar, because large differences in spread can also affect ANOVA results.

2\. Testing Equal Variances

Equal variances (homoscedasticity) matter because ANOVA assumes that all groups have about the same level of variability. If one continent’s life expectancy values are way more spread out than another’s, the results can be misleading.

$$
\ H_0: \text{The variances of life expectancy among continents are equal.} \\
\ H_a: \text{At least one group’s variance differs.}
$$

We used the Bartlett statistic, which tests whether the variances of life expectancy across groups ($j$) are equal. It compares each group’s sample variance ($s_j^2$) to the pooled variance ($s_p^2$) that would be expected if all groups had the same variability. The Bartlett statistic ($B_{\text{stat}}$) is computed as: $$
Bstat = \frac{v * ln(s_p^2) - (\sum_{j=1}^{g}v_j * ln(s_j^2) )}{1 + \frac{1}{3(g-1)}* [(\sum_{j=1}^{g} \frac{1}{v_j})- \frac{1}{v}]}
$$

First, we split the dataset by continent so that we could calculate each group’s mean, variance, and sample size:

```{r 1.1}
xs = split(x, data_2000$Continent)
xbarj = sapply(xs, mean)
s2j = sapply(xs, var)
nj= sapply (xs, length)
```

Each continent’s variance ($s_j^2$) represents how spread out its life expectancy values are. Then we calculated each group’s degrees of freedom ($v_j=n_j-1$) and counted the number of groups ($g$):

```{r 1.2}
vj= nj-1
g= length(unique(data_2000$Continent))
```

Next, we computed the pooled variance, which combines the group variances into a single weighted value based on their degrees of freedom: $$
s_p^2=\frac{\sum_{j=1}^{g}v_js_j^2}{\sum_{j=1}^{g}v_j}
$$

```{r 1.3}
sp2 = sum(vj * s2j)/ sum(vj)
```

After defining the components for each continent (sample variance $s_j^2$, degrees of freedom $v_j$, and the number of groups $g$), we computed the Bartlett statistic:

```{r 1.4}
bastat = ((sum(vj) * log(sp2)) - sum(vj * log(s2j)))/
  (1+ 1/(3*(g-1))* (sum(1/vj)- 1/sum(vj)))

pval = pchisq(bastat, g-1, lower.tail= F)

cat("Bartlett’s Test Statistic:", round(bastat, 4), "\n")
cat("Bartlett’s Test P-Value:", round(pval, 4), "\n")
```

The Bartlett’s test returned a test statistic of 26.51 and a p-value of 0.0001, which is below the alpha level of 0.10. This means we reject the null hypothesis and conclude that the variances of life expectancy are not equal across continents. So, the spread of life expectancy values differs depending on the region.

**Kruskal–Wallis Test: Comparing Continents in 2000**

Since both assumptions, normality and equal variances, were violated, we used the Kruskal–Wallis test as a non-parametric alternative to the one-way ANOVA. This test compares the median ranks of life expectancy across continents rather than their means.

The hypotheses are:

If we reject , it means that at least one continent’s life expectancy distribution is significantly different from the others.

## Repeated-Measures ANOVA test

While the one-way ANOVA looked at whether life expectancy differed between continents in a single year, the repeated-measures ANOVA examines how life expectancy changed over time within the same continents. Each continent represents a single subject measured repeatedly from 2000 to 2015. This allows us to see if the average life expectancy changed significantly during that period.

The hypotheses for this test are:

$$
\ H_0: \mu_{\text{2000}} = \mu_{\text{2001}} = \mu_{\text{2002}}  = ... = \mu_{\text{2015}} \quad \text{vs.} \quad H_a: \text{at least one mean differs.} 
$$

Before running the repeated-measures ANOVA, it is important to check the main assumptions: normality, sphericity, and independence.

**1. Normality**

Before running the repeated-measures ANOVA, I checked the normality assumption using the Lilliefors Kolmogorov–Smirnov test. The null hypothesis states that the data follows a normal distribution, while the alternative suggests that they deviate from normality. I used a Monte Carlo simulation to create a null distribution for the KS statistic by repeatedly sampling from a normal distribution. This helped me get a more accurate p-value and confirm whether the normality assumption was met.

```{r m1}
set.seed(123123)
x = mydata$Life.Expectancy
mc_ks = c()
x_sorted = sort(x)
n = length(x_sorted)

# Lilliefors Kolmogorov–Smirnov test
F_emp = (1:n) / (n+1) 
F_null = pnorm(x_sorted, mean(x_sorted), sd(x_sorted)) 
KS_obs = max(abs(F_emp - F_null))
KS_obs

# Monte Carlo simulation
for (k in 1:nmc) {
  Smc = sort(rnorm(n, mean(x), sd(x)))             
  F_emp_mc = (1:n) / (n + 1)          
  F_null_mc = pnorm(Smc, mean(Smc), sd(Smc))      
  mc_ks = c(mc_ks, max(abs(F_emp_mc - F_null_mc)))
}
emp_pval = mean(mc_ks >= KS_obs)
emp_pval
```

The results of the Lilliefors Kolmogorov–Smirnov test indicated that the life expectancy data deviate from a normal distribution. The observed KS statistic was 0.129, and the Monte Carlo simulation with 10,000 replications returned a p-value of approximately 0, which is below the alpha level of 0.10. Therefore, the null hypothesis of normality was rejected. This suggests that the life expectancy data are not perfectly normal.

Since the normality assumption was violated, I used a bootstrap approach to get an empirical p-value for the repeated-measures ANOVA. I generated 10,000 bootstrap samples by resampling the continents with replacement and recalculated the F-statistic for each sample. The bootstrap distribution of those F-values was then compared to the observed statistic to estimate the p-value. This method lets me test whether life expectancy changed significantly over time without having to rely on the normality assumption.

```{r m2}
source("functions.R")
X = tapply(mydata$Life.Expectancy,
            list(mydata$Continent, mydata$Year),
            mean)
X = as.matrix(X)


set.seed(123123)
N = 10000

F_obs = rm.ANOVA(X)$Fstat
F_boot = c()
n = nrow(X)

for (k in 1:N) {
  boot_index = sample(1:n, n, replace = TRUE)
  X_boot = X[boot_index, ]
  F_boot = c(F_boot, rm.ANOVA(X_boot)$Fstat)
}

p_boot = mean(F_boot >= F_obs)

F_obs
p_boot

```

Using a bootstrap approach with 10,000 replications, the empirical p-value for the repeated-measures ANOVA was approximately 0.67. This suggests that the observed F-statistic (F = 22.96) is not extreme under the null distribution, meaning there is no significant evidence that mean life expectancy changed across years. In other words, life expectancy remained relatively stable over the 2000–2015 period when accounting for variability between continents.
