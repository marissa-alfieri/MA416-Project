---
title: "Life Expectancy Trends (2000-2015)"
author: "Marissa Alfieri, Jenny Zheng, Letitia Caspersen"
date: "2025-11-04"
output:
  pdf_document:
    latex_engine: xelatex
---

## Introduction

Life expectancy says a lot about how people live and the conditions they face around the world. In this project, we wanted to look at how life expectancy differs across continents and how it changes over time. We started by checking whether continents already had different average life expectancies in the year 2000. That way we could get a baseline snapshot of global inequality. Then, we tested whether those differences changed between 2000 and 2015 to see if countries have been getting closer together or if the gap has stayed the same.

The main goal is to understand whether the differences in life expectancy reflect ongoing global inequality or improvements that are happening unevenly across regions.

The data come from Kaggle’s Life Expectancy 2000–2015 dataset (<https://www.kaggle.com/datasets/vrec99/life-expectancy-2000-2015>), which combines information from the World Health Organization, World Bank, and the United Nations. It includes 119 countries across 15 years, with variables like GDP per capita, CO₂ emissions, health expenditure, and internet access.

```{r intro}
data = read.csv("Life_Expectancy.csv")
```

## Section 1 – Comparing Continents in 2000

We wanted to start by establishing a baseline for global inequality in life expectancy. To see whether people in some continents were living longer than others at the start of the 21st century.

Our hypotheses were:

> $H_0: \text{The distributions of life expectancy are the same across all continents.}$
>
> $H_a: \text{At least one continent differs.}$

### **Checking The Assumptions**

We planned to test this using a one-way ANOVA, so we first checked whether the assumptions of normality and equal variances were met.

#### **1. Normality**

Normality is important because ANOVA assumes that residuals within each group are normally distributed.

$$
\ H_0: \text{The life expectancy values within each continent are normally distributed.}
$$

$$
\ H_a: \text{The life expectancy values within at least one continent deviate from normality.}
$$

For normality, we visually inspected histograms of life expectancy for each continent.

```{r, fig.width=8, fig.height=6, echo=FALSE}
data_2000 = subset(data, Year == 2000)
x = data_2000$Life.Expectancy
continents = unique(data_2000$Continent)

par(mfrow = c(2, 3), mar = c(4, 4, 3, 1))

		
for (c in continents){
subset_data=data_2000$Life.Expectancy[data_2000$Continent == c]
  
 			 hist(subset_data,
  			     main = paste(c, "2000"),
       xlab = "Life Expectancy",
       ylab = "Frequency",
       col = "skyblue",
       breaks = 5)
}

```

Visual inspection of the histograms suggested that the distributions were varied, with some having approximately bell shaped curves, some with unique distributions, and some skewed. To confirm normality statistically, we used a Monte Carlo Anderson–Darling test.

This test measures how far the observed data deviates from what would be expected under a normal distribution with the same mean and standard deviation. Comparing our observed statistic to this simulated one let us estimate the p-value and decide whether the normality assumption held.

```{r mc.ad}
set.seed(123123)
nmc = 10000
n = length(x)
mc_ad = c()

# observed statistic
x_sorted = sort(x)
F_emp = (1:n) / (n+1)
F_null = pnorm(x_sorted, mean(x_sorted), sd(x_sorted)) 
AD_obs = sum(((abs(F_emp - F_null))^2) / (F_emp * (1 - F_emp)))

# simulated normality
for(k in 1:nmc){
  smc = sort(rnorm(n, 0, 1))
  F_emp_mc = (1:n)/(n+1)
  F_null_mc = pnorm(smc, 0, 1)
  mc_ad = c(mc_ad, sum((F_emp_mc - F_null_mc)^2 / (F_emp_mc * (1 - F_emp_mc))))
  }

alpha = 0.10
ad_crit = quantile(mc_ad, 1 - alpha)
emp_pval = mean(mc_ad >= AD_obs)
```

```{r mc.ad2, echo=FALSE}
cat("Anderson–Darling Critical Value:", round(ad_crit), "\n")
cat("Empirical P-Value:", round(emp_pval), "\n")
```

The Anderson–Darling test gave an empirical p-value of 0.0004, which is below the alpha level of 0.10. This means we reject the null hypothesis of normality. So, the life expectancy data for 2000 aren’t normally distributed. This makes sense because some continents have much higher averages while others are lower, so the data are naturally skewed instead of bell-shaped. Before deciding how to move forward, we also wanted to check whether the variability between groups was similar, because large differences in spread can also affect ANOVA results.

#### **2. Testing Equal Variances**

Equal variances (homoscedasticity) matter because ANOVA assumes that all groups have about the same level of variability. If one continent’s life expectancy values are way more spread out than another’s, the results can be misleading.

$$
\ H_0: \text{The variances of life expectancy among continents are equal.}
$$

$$
\ H_a: \text{At least one group’s variance differs.}
$$

We used the Bartlett statistic, which tests whether the variances of life expectancy across groups ($j$) are equal. It compares each group’s sample variance ($s_j^2$) to the pooled variance ($s_p^2$) that would be expected if all groups had the same variability. The Bartlett statistic ($B_{\text{stat}}$) is computed as:

$$
Bstat = \frac{v * ln(s_p^2) - (\sum_{j=1}^{g}v_j * ln(s_j^2) )}{1 + \frac{1}{3(g-1)}* [(\sum_{j=1}^{g} \frac{1}{v_j})- \frac{1}{v}]}
$$

First, we split the dataset by continent so that we could calculate each group’s mean, variance, and sample size:

```{r 1.1}
xs = split(x, data_2000$Continent)
xbarj = sapply(xs, mean)
s2j = sapply(xs, var)
nj= sapply (xs, length)
```

Each continent’s variance ($s_j^2$) represents how spread out its life expectancy values are. Then we calculated each group’s degrees of freedom ($v_j=n_j-1$) and counted the number of groups ($g$):

```{r 1.2}
vj= nj-1
g= length(unique(data_2000$Continent))
```

Next, we computed the pooled variance, which combines the group variances into a single weighted value based on their degrees of freedom: $$
s_p^2=\frac{\sum_{j=1}^{g}v_js_j^2}{\sum_{j=1}^{g}v_j}
$$

```{r 1.3}
sp2 = sum(vj * s2j)/ sum(vj)
```

After defining the components for each continent (sample variance $s_j^2$, degrees of freedom $v_j$, and the number of groups $g$), we computed the Bartlett statistic:

```{r 1.4}
bastat = ((sum(vj) * log(sp2)) - sum(vj * log(s2j)))/
  (1+ 1/(3*(g-1))* (sum(1/vj)- 1/sum(vj)))

pval = pchisq(bastat, g-1, lower.tail= F)
```

```{r 1.4.2, echo=FALSE}
cat("Bartlett’s Test Statistic:",bastat, "\n")
cat("Bartlett’s Test P-Value:", pval, "\n")
```

The Bartlett’s test returned a test statistic of 26.51 and a p-value of 0.0001, which is below the alpha level of 0.10. This means we reject the null hypothesis and conclude that the variances of life expectancy are not equal across continents. So, the spread of life expectancy values differs depending on the region.

### **Kruskal–Wallis Test: Comparing Continents in 2000**

Since both assumptions, normality and equal variances, were violated, we used the Kruskal–Wallis test instead of a standard one-way ANOVA. Instead of comparing the means of the groups, it compares the ranks of the data to see whether the distributions differ across continents.

The hypotheses are:

$$
\ H_0: \text{The distributions of life expectancy are the same across all continents.} 
$$

$$
\ H_a: \text{At least one continent differs.}
$$

We used the Kruskal–Wallis statistic, which tests whether the distributions of life expectancy across groups ($j$) are the same. It ranks all observations together, then compares the average rank within each group ($\bar{R}_j$) to the overall mean rank ($\bar{R}$). If the group ranks differ a lot, it suggests that at least one continent’s distribution is different. The Kruskal–Wallis statistic ($H$) is computed as:

$$
H = \frac{12}{N(N + 1)} \sum_{j=1}^{g} n_j (\bar{R}_j - \bar{R})^2
$$

```{r m1}
R_all = rank(unlist(xs))
Rj = split(R_all, rep(names(xs), times = sapply(xs, length)))
nj = sapply(Rj, length)
N = sum(nj)
g = length(Rj)
Rbar_j = sapply(Rj, mean)
Rbar = (N + 1) / 2

H_stat = (12 / (N * (N + 1))) * sum(nj * (Rbar_j - Rbar)^2)
pval_kw = pchisq(H_stat, g - 1, lower.tail = FALSE)
```

```{r m1.2, echo=FALSE}
cat("Kruskal–Wallis H Statistic:", H_stat, "\n")
cat("P-Value:", pval_kw, "\n")
```

The Kruskal–Wallis test returned an $H$ statistic of 65.03 with a p-value of 1.10 **×** 10⁻¹², which is below the alpha level of 0.10. This means we reject the null hypothesis and conclude that life expectancy distributions differ significantly across continents in the year 2000.

Therefore, there was clear inequality in life expectancy at the start of the 21st century, some regions were already living much longer on average than others. This result confirms that the gap in global health outcomes was large even before major medical and economic developments of the following decades.

## Section 2 – Comparing Continents in from 2000-2015

After finding that life expectancy differed across continents in 2000, we wanted to see whether those differences changed over time. Did the gap between regions decrease or have some continents continued to fall behind? To figure that out, we looked at how the average life expectancy changed from 2000 to 2015.

Our hypotheses were:

$$
H_0: \mu_{\text{2000}} = \mu_{\text{2001}} = \mu_{\text{2002}} = \dots = \mu_{\text{2015}} \\H_a: \text{At least one mean differs.}
$$

### **Checking The Assumptions** 

We planned to test this using a repeated-measures ANOVA, so we first checked whether the assumptions of normality, sphericity, and independence were met.

#### **1. Normality** 

Normality is important because repeated-measures ANOVA assumes that the residuals (or differences between time points) are roughly normally distributed.

$$
\ H_0: \text{The life expectancy values across years are normally distributed.} \\
\ H_a: \text{The life expectancy values deviate from normality.}
$$
To test this, we used the Kolmogorov–Smirnov test, which compares the sample’s cumulative distribution to a normal distribution with the same mean and standard deviation.

The KS statistic ($D$) is computed as:

$$
D = \max \left| F_{\text{emp}}(x) - F_{\text{null}}(x) \right|
$$

In R, it was calculated as:

```{r m2}
x = data$Life.Expectancy
x_sorted = sort(x)
set.seed(123123)
nmc = 10000
n = length(x_sorted)

# observed statistic
F_emp = (1:n) / (n+1)
F_null = pnorm(x_sorted, mean(x_sorted), sd(x_sorted)) 
KS_obs = max(abs(F_emp - F_null))

# simulated normality
KS_mc = c()
for(k in 1:nmc){
  smc = sort(rnorm(n, 0, 1))
  F_emp_mc = (1:n) / (n+1)
  F_null_mc = pnorm(smc, 0, 1)
  KS_mc = c(KS_mc, max(abs(F_emp_mc - F_null_mc)))
  }

alpha = 0.10
KS_crit = quantile(KS_mc, 1 - alpha)
emp_pval = mean(KS_mc >= KS_obs)
```

```{r m2.2, echo=FALSE}
cat("Kolmogorov–Smirnov Critical Value:", KS_crit, "\n")
cat("Empirical P-Value:", emp_pval, "\n")
```

The Kolmogorov–Smirnov test gave a critical value of 0.0279 and an empirical p-value of 0, which is below the alpha level of 0.10. This means we reject the null hypothesis of normality. So, the life expectancy values across years aren’t normally distributed. Before deciding how to move forward, we also wanted to check the assumption of sphericity, which deals with the relationships between repeated measurements over time.

#### **2. Sphericity**

Sphericity is the repeated-measures version of equal variances. It assumes that the variances of the differences between every pair of years are roughly equal.

$$
\ H_0: \text{The variances of the differences between all pairs of years are equal.} \\
\ H_a: \text{At least one pair of years differs in variance of differences.}
$$

We computed Mauchly’s test to evaluate the sphericity assumption. This test measures whether the covariance matrix of repeated measures is close to spherical.

The Mauchly statistic ($W$) is calculated as:
$$
W = \frac{|\Sigma|}{\left( \frac{\text{tr}(\Sigma)}{k} \right)^k}
$$

where $|\Sigma|$ is the determinant of the covariance matrix and $\text{tr}(\Sigma)$ is its trace.

The test statistic ($M_{\text{stat}}$ ) is then computed as:

$$
M_{\text{stat}} = -(n - 1) \ln(W)
$$

is then computed as:

```{r m3, echo = FALSE}
X = tapply(data$Life.Expectancy,
           list(data$Continent, data$Year),
           mean)
x = as.matrix(X)
```

```{r m4}
k = ncol(x)
n = nrow(x)
c = cov(x)
tr = sum(diag(c))
det = det(c)

W = det / ((tr / k)^k)
Mstat = -(n-1) * log(W) 
df = (k*(k-1)/2)
Mcrit = qchisq(1-0.10, df)
Mpval = pchisq(Mstat, df,lower.tail = F)
```

```{r m4.2, echo=FALSE}
cat("Mauchly's Test Statistic:", Mstat, "\n")
cat("Mauchly's Test P-Value:", Mpval, "\n")
```

Section 3 – Life Expectancy and Factor

bootstrap regression and add in a graph
